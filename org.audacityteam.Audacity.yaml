app-id: org.audacityteam.Audacity

runtime: org.freedesktop.Platform
runtime-version: '19.08'
sdk: org.freedesktop.Sdk

command: audacity
rename-desktop-file: audacity.desktop
rename-icon: audacity
rename-appdata-file: audacity.appdata.xml

finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=pulseaudio
  - --filesystem=host
  - --env=DCONF_USER_CONFIG_DIR=.config/dconf
  - --filesystem=xdg-run/dconf
  - --filesystem=~/.config/dconf:ro
  - --talk-name=ca.desrt.dconf
  - --env=ALSA_CONFIG_PATH=

add-extensions:
  org.freedesktop.Platform.ffmpeg-full:
    directory": "lib/ffmpeg"
    version": "19.08"
    add-ld-path": "."

cleanup:
  - /include
  - /lib/pkgconfig
  - /share/aclocal
  - /share/man
  - '*.la'
  - '*.a'

modules:
  - shared-modules/python2.7/python-2.7.json

  - name: wxwidgets
    rm-configure: true
    config-opts:
      - --with-libpng
      - --with-zlib
      - --disable-sdltest
      - --disable-webkit
      - --disable-webview
      - --disable-webviewwebkit
      - --disable-ribbon
      - --disable-propgrid
      - --disable-xru
      - --disable-richtext
      - --with-expat=builtin
      - --with-libiconv=/usr
    sources:
      - type: script
        dest-filename: autogen.sh
        commands:
          - cp -p /usr/share/automake-*/config.{sub,guess} .
          - autoconf -f -B build/autoconf_prepend-include
      - type: archive
        url: https://github.com/wxWidgets/wxWidgets/releases/download/v3.0.4/wxWidgets-3.0.4.tar.bz2
        sha256: 96157f988d261b7368e5340afa1a0cad943768f35929c22841f62c25b17bf7f0
    cleanup:
      - /bin
      - /lib/wx
      - /share/bakefile

  - libid3tag/libid3tag.json

  - name: chrpath
    sources:
      - type: archive
        url: https://sourceforge.net/projects/pisilinux/files/source/chrpath-0.16.tar.gz
        sha256: bb0d4c54bac2990e1bdf8132f2c9477ae752859d523e141e72b3b11a12c26e7b
    cleanup:
      - '*'

  - name: audacity
    config-opts:
      - --enable-shared
      - --disable-static
      - --disable-dynamic-loading
      - --without-libmad
    build-options:
      arch:
        i386:
          config-opts:
            - --disable-sse
        arm:
          config-opts:
            - --disable-sse
        aarch64:
          config-opts:
            - --disable-sse
    post-install:
      - chrpath -d /app/bin/audacity
      - mv /app/share/mime/packages/audacity.xml /app/share/mime/packages/org.audacityteam.Audacity.xml            
    sources:
      - type: archive
        url: https://github.com/audacity/audacity/archive/Audacity-2.3.2.tar.gz
        sha256: cc477a71ff5571c72887a7a155365b07a1a50bcea1abf490a4de7b884376c731
      - type: patch
        path: appdata-add-oars.patch
    cleanup:
      - /share/audacity/include
      - /share/pixmaps

