{
    "app-id": "org.audacityteam.Audacity",
    "branch": "stable",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "1.6",
    "sdk": "org.freedesktop.Sdk",
    "command": "audacity",
    "finish-args": [
        "--share=ipc",
        "--socket=x11",
        "--socket=pulseaudio",
        "--filesystem=host",

        "--env=DCONF_USER_CONFIG_DIR=.config/dconf",
        "--filesystem=xdg-run/dconf",
        "--filesystem=~/.config/dconf:ro",
        "--talk-name=ca.desrt.dconf"
    ],
    "rename-appdata-file": "audacity.appdata.xml",
    "rename-desktop-file": "audacity.desktop",
    "rename-icon": "audacity",
    "cleanup": [
        "/include",
        "/lib/pkgconfig",
        "/share/aclocal",
        "/share/man",
        "*.la", "*.a"
    ],
    "modules": [
        {
            "name": "wxWidgets",
            "rm-configure": true,
            "cleanup": [
                "/bin",
                "/include",
                "/share/bakefile",
                "/share/aclocal"
            ],
            "config-opts": [
                  "--with-libpng",
                  "--with-zlib",
                  "--disable-sdltest",
                  "--disable-webkit",
                  "--disable-webview",
                  "--disable-webviewwebkit",
                  "--disable-ribbon",
                  "--disable-propgrid",
                  "--disable-xru",
                  "--disable-richtext",
                  "--with-expat=builtin",
                  "--with-libiconv=/usr"
              ],
              "sources": [
                 {
                     "type": "archive",
                     "url": "https://github.com/wxWidgets/wxWidgets/releases/download/v3.0.3.1/wxWidgets-3.0.3.1.tar.bz2",
                     "sha256":"3164ad6bc5f61c48d2185b39065ddbe44283eb834a5f62beb13f1d0923e366e4"
                 },
                 {
                     "type": "script",
                     "dest-filename": "autogen.sh",
                     "commands": [
                         "cp -p /usr/share/automake-*/config.{sub,guess} .",
                         "autoconf -f -B build/autoconf_prepend-include"
                     ]
                 }
            ]
        },
        "shared-modules/lame/lame-3.99.5.json",
        {
            "name": "opus",
            "config-opts": [
                "--disable-static",
                "--disable-doc",
                "--disable-extra-programs"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://archive.mozilla.org/pub/opus/opus-1.2.1.tar.gz",
                    "sha256": "cfafd339ccd9c5ef8d6ab15d7e1a412c054bf4cb4ecbbbcc78c12ef2def70732"
                }
            ]
        },
        {
            "name": "ffmpeg",
            "cleanup": ["/share/ffmpeg/examples"],
            "build-options" : {
                "arch" : {
                    "i386" : {"config-opts" : ["--arch=x86"]},
                    "arm" : {"config-opts" : ["--arch=arm"]}
                }
            },
            "config-opts": [
                "--enable-shared",
                "--disable-static",
                "--disable-programs",
                "--disable-doc",
                "--disable-everything",
                "--enable-libopus",
                "--enable-libmp3lame",
                "--enable-decoder=aac",
                "--enable-decoder=ac3",
                "--enable-decoder=wmav1",
                "--enable-decoder=wmav2",
                "--enable-decoder=wmalossless",
                "--enable-decoder=wmapro",
                "--enable-decoder=wmavoice",
                "--enable-decoder=opus",
                "--enable-decoder=mp3",
                "--enable-encoder=aac",
                "--enable-encoder=ac3",
                "--enable-encoder=wmav2",
                "--enable-demuxer=aac",
                "--enable-demuxer=asf",
                "--enable-demuxer=ac3",
                "--enable-demuxer=mov",
                "--enable-demuxer=mp3",
                "--enable-demuxer=ogg",
                "--enable-muxer=ac3",
                "--enable-muxer=asf",
                "--enable-muxer=ipod",
                "--enable-muxer=opus",
                "--enable-parser=aac",
                "--enable-parser=ac3",
                "--enable-parser=opus"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://ffmpeg.org/releases/ffmpeg-3.3.5.tar.xz",
                    "sha256": "a893490c3a8a7caaa9c47373b789c0335d0ac3572f2ba61059de842b9e45d802"
                }
            ]
        },
        {
            "name": "libid3tag",
            "config-opts": [
                "--disable-static"
            ],
            "post-install": [
                "install -Dm644 -t /app/lib/pkgconfig/ id3tag.pc"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://downloads.sourceforge.net/project/mad/libid3tag/0.15.1b/libid3tag-0.15.1b.tar.gz",
                    "sha256": "63da4f6e7997278f8a3fef4c6a372d342f705051d1eeb6a46a86b03610e26151"
                },
                {
                    "type": "file",
                    "path": "id3tag.pc"
                },
                {
                    "type": "shell",
                    "commands": [
                        "cp /usr/share/gnu-config/config.sub .",
                        "cp /usr/share/gnu-config/config.guess ."
                    ]
                }
            ]
        },
        {
            "name": "audacity",
            "cleanup": [
                "/share/audacity/include",
                "/share/pixmaps"
            ],
            "config-opts": [
                "--enable-shared",
                "--disable-static",
                "--disable-dynamic-loading"
            ],
            "build-options": {
                "arch": {
                    "i386": {"config-opts" : ["--disable-sse"]},
                    "arm": {"config-opts" : ["--disable-sse"]},
                    "aarch64": {"config-opts" : ["--disable-sse"]}
                }
            },
            "sources": [
                {
                    "type": "archive",
                    "url": "https://fossies.org/linux/misc/audacity-minsrc-2.2.2.tar.xz",
                    "sha256": "97751a00e33026b61d05057c1525d6dddfd4e64737bd35f59dc2e21e3d6762e2"
                },
                {
                    "type": "file",
                    "path": "audacity.appdata.xml"
                }
            ],
            "post-install": [
                "mv /app/share/mime/packages/audacity.xml /app/share/mime/packages/org.audacityteam.Audacity.xml",
                "rm /app/share/appdata/audacity.appdata.xml",
                "install -Dm644 -t /app/share/appdata audacity.appdata.xml"
            ]
        }
    ]
}
